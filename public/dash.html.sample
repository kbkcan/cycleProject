<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

    <title>CYCLE DASH</title>

    <!-- TODO 1. firebase SDK 링크 -->
    <script src="https://www.gstatic.com/firebasejs/5.4.1/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.4.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.4.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.4.1/firebase-database.js"></script>
    
    <!-- Custom -->
    <script src="index.js"></script>
    <script src="fireinit.js"></script>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    
    <!--external css-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="assets/css/zabuto_calendar.css">
    <link rel="stylesheet" type="text/css" href="assets/js/gritter/css/jquery.gritter.css" />
    <link rel="stylesheet" type="text/css" href="assets/lineicons/style.css">
    <link rel="stylesheet" type="text/css" href="assets/css/theme.css">

    <!-- Custom styles for this template -->
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/style-responsive.css" rel="stylesheet">

    <script src="assets/js/chart-master/Chart.js"></script>
    
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        #serverstatus01{
            width: 100% !important;
            height: 100% !important;
        }
    
    </style>
  </head>

  <body>
  <section id="container" >
      <!-- **********************************************************************************************************************************************************
      TOP BAR CONTENT & NOTIFICATIONS
      *********************************************************************************************************************************************************** -->
      <!--header start-->
      <header class="header black-bg" style="position: fixed;">
              <div class="sidebar-toggle-box">
                  <div id="BTN_TOOLTIPS" class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
              </div>
            <!--logo start-->
            <a href="./" class="logo"><b>CYCLE DASH</b></a>
            <!--logo end-->
            <div class="top-menu">
            	<ul class="nav pull-right top-menu">
                    <!-- 로그아웃, 마이페이지 버튼 -->
                    <li><a id="BTN_LOGOUT" type="button" class="logout" href="#" style="display: none;">Logout</a></li>
                    <!-- <li><a id="BTN_MYPAGE" type="button" class="logout" href="#" style="display: none;">마이페이지</a></li> -->
            	</ul>
            </div>
            <!-- <span id="AUTH_STATE" class="blue-text">(인증되지 않음)</span> -->
                
            <!-- 유저 정보 확인용 요소 추가 -->
            <!--
            <div>         
                <ol id="USER_INFO">
				  <li>UID : <span id="USER_UID" class="blue-text"></span></li>
				  <li>메일 : <span id="USER_MAIL" class="blue-text"></span></li>
				  <li>이름 : <span id="USER_NAME" class="blue-text"></span></li>
				  <li><img id="USER_PHOTO"></li>
                </ol> 
            </div>
            -->
		
        </header>
      <!--header end-->

      <!-- **********************************************************************************************************************************************************
      MAIN SIDEBAR MENU
      *********************************************************************************************************************************************************** -->
      <!--sidebar start-->
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <!-- sidebar menu start-->
              <ul class="sidebar-menu" id="nav-accordion">
              
              	  <p class="centered"><a href="#"><img src="assets/img/ui-sam.jpg" class="img-circle" width="60"></a></p>
              	  <h5 class="centered">Profile</h5>

                  <li class="mt"> 
                      <a class="" href="./">
                          <i class="fa fa-home"></i>
                          <span>홈</span>
                      </a>
                  </li>
                  <li class="mt">
                        <a class="" href="./mypage.html">
                            <i class="fa fa-user"></i>
                            <span>마이페이지</span>
                        </a>
                    </li>

                  <li class="sub-menu">
                        <a href="javascript:;" >
                            <i class=" fa fa-chart-bar"></i>
                            <span>통계</span>
                        </a>
                        <ul class="sub">
                            <li><a  href="morris.html">주간</a></li>
                            <li><a  href="chartjs.html">월별</a></li>
                        </ul>
                    </li>

                  
                  <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-book"></i>
                          <span>Extra Pages</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="blank.html">Blank Page</a></li>
                          <li><a  href="login.html">Login</a></li>
                          <li><a  href="lock_screen.html">Lock Screen</a></li>
                      </ul>
                  </li>
                  <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-tasks"></i>
                          <span>Forms</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="form_component.html">Form Components</a></li>
                      </ul>
                  </li>
                  <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-th"></i>
                          <span>Data Tables</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="basic_table.html">Basic Table</a></li>
                          <li><a  href="responsive_table.html">Responsive Table</a></li>
                      </ul>
                  </li>
              </ul>
              <!-- sidebar menu end-->
          </div>
      </aside>
      <!--sidebar end-->
      
      <!-- **********************************************************************************************************************************************************
      MAIN CONTENT
      *********************************************************************************************************************************************************** -->
      <!--main content start-->
      <section id="main-content">
            <section class="wrapper">
                        <!-- TWITTER PANEL -->
						<div class="col-md-4 mb">
                              <div class="darkblue-panel" style="background: none; height: 100%;">
                      			<div class="darkblue-header"><br> 
                                    <h3 style="color:#777777; font-weight: bold;">오늘 소모한 칼로리</h3>
                                      
                      			</div>
                                  <div class="row" style="display:inline-block !important;">
                                    <div class="col-xs-6">
                                        <canvas id="serverstatus01" height="100%" width="100%"></canvas>
                                        <script type="text/javascript">
                                        firebase.database().ref('/user').on('value', function(snapshot) {
                                            // firebase.database().ref('/user/testKcal').on('value', function(kcal) {
                                            /* 
                                                targetKcal는 목표치 칼로리 ex) 1000
                                                startVal는 초기 변수 값 = 0
                                                kcal 칼로리 소모 변수
                                                addKcal는 누적 칼로리
                                            */
                                            kcal_parent=snapshot.val()
                                            var targetKcal = parseFloat(kcal_parent['targetKcal']);
                                            var addKcal = parseFloat(kcal_parent['addKcal']);
                                            var startVal = 0;
                                            // $('#DB_kcal').text() = addKcal + 'Kcal';
                                            console.log(targetKcal,addKcal);
                                            if (addKcal >= targetKcal){
                                                alert('목표 칼로리를 달성했습니다.');
                                                var updates = {};
                                                updates['/user/addKcal'] = 0;
                                                firebase.database().ref().update(updates);
                                            }
                                            var doughnutData = [
                                                {   /* 100, 0 달성완료 */
                                                    value: startVal + addKcal,
                                                    color: "#68dff0"
                                                },
        
                                                {   /* 0, 100 칼로리 초기화 */
                                                    value: targetKcal - addKcal,
                                                    color: "#444c57"
                                                }
                                            ];
                                            // var myDoughnut = new Chart(document.getElementById("serverstatus01").getContext("2d")).Doughnut(doughnutData);
                                            var myDoughnut = new Chart(document.getElementById("serverstatus01").getContext("2d")).Doughnut(doughnutData);
                                            myDoughnut.fillText
                                            var ctx = canvas.getContext("2d");
                                            ctx.font = '30px Arial';
                                            ctx.fillText("Hello World", 10, 50);
                                            // ctx.
                                        // });
                                    });
                                        </script>
                                    </div>
                                    <div class="col-xs-6" style="text-align: center; padding-top:13%;"> 
                                        <div style="color: #989898;" class="figure"><i class="fa fa-fire" style="font-size:1em"></i><span id="DB_kcal" style="font-size:1.1em; margin-left:5px;">627</span>Kcal</div>
                                    </div>
                                </div>
                            </div><!-- /col-md-4 -->
                        <div class="row">
                            <div class="col-lg-12 main-chart">
                                <div class="row mtbox">
                                    <div class="col-md-4 col-sm-4 col-xs-4 box0">
                                        <div class="box1 stat">
                                            <div>심박수</div>
                                            <span class="fa fa-heartbeat stat-img"></span>
                                            <div  style="font-size:1em; font-weight: bold;"><span style="font-size:1em; font-weight: bold; margin-top:14px;" id="DB_BPM">90</span>BPM</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-sm-4 col-xs-4 box0">
                                        <div class="box1 stat">
                                            <div>평균속도</div>
                                            <span class="fab fa-cloudscale stat-img"></span>
                                            <div style="font-size:1em; font-weight: bold;"><span style="font-size:1em; font-weight: bold; margin-top:14px;" id="DB_speed">20</span>Km/h</span></div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-sm-4 col-xs-4 box0">
                                        <div class="box1 stat">
                                            <div>거리</div>
                                            <span class="fas fa-bicycle stat-img"></span>
                                            <div style="font-size:1em; font-weight: bold;"><span style="font-size:1em; font-weight: bold; margin-top:14px;" id="DB_distance">30</span>Km</div>
                                        </div>
                                    </div>
                                </div><!-- /row mt -->
                                <br>
                                <div style="border:1px solid #dedede; width:100%; height:250px; line-height:250px; color:#666;font-size:100px; text-align:center;" id="clock"><h2>0 : 0 : 0</h2></div>
                                    <div class="btn-group btn-group-justified" role="group">
                                        <a  class="btn btn-success" id="startPlay" onclick="startPlay();">운동시작</a >
                                        <a  class="btn btn-warning disabled" id="pause" onclick="pause();">일시정지</a >
                                        <a  class="btn btn-danger disabled" id="endPlay" onclick="endPlay();">운동종료</a >
                                    </div>
                
                                <div class="row">
                                    <!-- TWITTER PANEL -->
        
        
                                    <div class="col-md-12 col-sm-12 mb">
                                        <!-- REVENUE PANEL -->
                                        <div class="darkblue-panel pn">
                                            <div class="darkblue-header">
                                                <h5>주간 칼로리소모량</h5>
                                            </div>
                                            <div class="chart mt">
                                                <div class="sparkline" data-type="line" data-resize="true" data-height="75"
                                                    data-width="90%" data-line-width="1" data-line-color="#fff" data-spot-color="#fff"
                                                    data-fill-color="" data-highlight-line-color="#fff" data-spot-radius="4"
                                                    data-data="[200,135,667,333,526,996,564,123,890,464,655]"></div>
                                            </div>
                                        </div>
                                    </div><!-- /col-md-4 -->
        
                                </div><!-- /row -->
        
                            </div><!-- /col-lg-9 END SECTION MIDDLE -->
                  
                  
      <!-- **********************************************************************************************************************************************************
      RIGHT SIDEBAR CONTENT
      *********************************************************************************************************************************************************** -->
              </div><!-- /row -->
              <div class="col-lg-9">
                <h2 class="title-1 m-b-25">Earnings By Items</h2>
                <div class="table-responsive table--no-card m-b-40">
                    <table class="table table-borderless table-striped table-earning">
                        <thead>
                            <tr>
                                <th>날짜</th>
                                <th>목표(Kcal)</th>
                                <th>소모(Kcal)</th>
                                <th class="text-right">달성률</th>

                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2018-09-29 05:57</td>
                                <td>1000</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>

                            </tr>
                            <tr>
                                <td>2018-09-28 01:22</td>
                                <td>1000</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>

                            </tr>
                            <tr>
                                <td>2018-09-27 02:12</td>
                                <td>1000</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>

                            </tr>
                            <tr>
                                <td>2018-09-26 23:06</td>
                                <td>1000</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>

                            </tr>
                            <tr>
                                <td>2018-09-25 19:03</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>

                            </tr>
                            <tr>
                                <td>2018-09-29 05:57</td>
                                <td>100392</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>

                            </tr>
                            <tr>
                                <td>2018-09-24 19:10</td>
                                <td>100391</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>

                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                            <tr>
                                <td>2018-09-22 00:43</td>
                                <td>100393</td>
                                <td>3000</td>
                                <td class="text-right">300%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
          </section>
      </section>

      <!--main content end-->
  </section>

    <!-- js placed at the end of the document so the pages load faster -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/jquery-1.8.3.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script class="include" type="text/javascript" src="assets/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="assets/js/jquery.scrollTo.min.js"></script>
    <script src="assets/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script src="assets/js/jquery.sparkline.js"></script>


    <!--common script for all pages-->
    <script src="assets/js/common-scripts.js"></script>
    
    <script type="text/javascript" src="assets/js/gritter/js/jquery.gritter.js"></script>
    <script type="text/javascript" src="assets/js/gritter-conf.js"></script>

    <!--script for this page-->
    <script src="assets/js/sparkline-chart.js"></script>    
	<script src="assets/js/zabuto_calendar.js"></script>	
	
	<!-- <script type="text/javascript">
        $(document).ready(function () {
        var unique_id = $.gritter.add({
            // (string | mandatory) the heading of the notification
            title: 'Welcome to Dashgum!',
            // (string | mandatory) the text inside the notification
            text: 'Hover me to enable the Close Button. You can hide the left sidebar clicking on the button next to the logo. Free version for <a href="http://blacktie.co" target="_blank" style="color:#ffd777">BlackTie.co</a>.',
            // (string | optional) the image to display on the left
            image: 'assets/img/ui-sam.jpg',
            // (bool | optional) if you want it to fade out on its own or just sit there
            sticky: true,
            // (int | optional) the time you want it to be alive for before fading out
            time: '',
            // (string | optional) the class name you want to apply to that specific message
            class_name: 'my-sticky-class'
        });

        return false;
        });
	</script> -->
	
	<script type="application/javascript">
        $(document).ready(function () {
            $("#date-popover").popover({html: true, trigger: "manual"});
            $("#date-popover").hide();
            $("#date-popover").click(function (e) {
                $(this).hide();
            });
        
            $("#my-calendar").zabuto_calendar({
                action: function () {
                    return myDateFunction(this.id, false);
                },
                action_nav: function () {
                    return myNavFunction(this.id);
                },
                ajax: {
                    url: "show_data.php?action=1",
                    modal: true
                },
                legend: [
                    {type: "text", label: "Special event", badge: "00"},
                    {type: "block", label: "Regular event", }
                ]
            });
        });
        
        
        function myNavFunction(id) {
            $("#date-popover").hide();
            var nav = $("#" + id).data("navigation");
            var to = $("#" + id).data("to");
            console.log('nav ' + nav + ' to: ' + to.month + '/' + to.year);
        }
    </script>

    <!--Import jQuery before materialize.js-->
    <!-- <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="js/materialize.min.js"></script>  -->
    
    <script type="text/javascript"> 
    /* 파이어 베이스 인증 */
    firebase.auth().onAuthStateChanged(function(user) {
    if (user) { // 인증되었을 때
      $('#AUTH_STATE').text(user.displayName + "님 로그인 하셨습니다.");
      $('#BTN_LOGOUT').show();
      $('#BTN_MYPAGE').show();
      $('#USER_NAME').text(user.displayName);
      $('#USER_MAIL').text(user.email);
      $('#USER_UID').text(user.uid);
      $('#USER_PHOTO').attr('src', user.photoURL);
      $('#USER_INFO').show();
    //   $('#BTN_TOOLTIPS').trigger('click');

      /* TODO 1. DB에서 '/user/addKcal'값 읽어오기 */
      firebase.database().ref('/user/addKcal').on('value', function(snapshot) {
           //debugger;
           var message = snapshot.val();
           messsage= message+'BPM'
           $("#DB_kcal").text(message);
       });

       firebase.database().ref('/user/BPM').on('value', function(snapshot) {
            //debugger;
            var message = snapshot.val();
            $("#DB_BPM").text(message);
        });
    } else { // 인증되지 않았을 때
      $('#AUTH_STATE').text("(인증되지 않음)");
      $('#BTN_LOGOUT').hide();
      $('#USER_INFO').hide();
    }
  });

  function User(weight,bike){
       this.weight = weight;
       this.bike = bike;
   };

   function Log(){
       this.endAt = null;
       this.startAt = null;
       this.distance = 0;
       this.kcal = 0;
       this.indice = 0;
       this.speed = 0;
   };

   function playing(log,user) {
       setInterval(function () {
           firebase.database().ref('/user').once('value').then(function(snapshot) {
           data = snapshot.val();
           console.log(log);
           console.log(data);   
           var cycleCount = parseInt(data['cycleCount']);
           log.endAt = new Date();

           //거리를 계산한다.
           log.distance = calDistance(user,cycleCount);
           $("#DB_distance").text(log.distance.toFixed(2));
           
           //속도를 구한다.
           log.speed = calSpeed(log);
           $("#DB_speed").text(log.speed.toFixed(2));
           console.log(cycleCount,'회 회전',log.distance,'M',log.speed,'km/h');
           });
       }, 10000);
   };

   function calKcal(log,user,cycleCount){
       //칼로리(kcal) = (몸무게 + 자전거무게) * 평속에 따른 소모열량지수 * 운동시간(분)
       log.speed = getSpeed(log);
       log.indice = getIndice(log.speed);
       log.kcal = (this.user.weight + this.user.bike.bike_weight) * this.indice * ((this.startAt - this.endAt)/60); 
       return log;
   };

   function calSpeed(log){
       var endAt = new Date();
       var speed = log.distance/((endAt - log.startAt)/(60/1000));
       console.log('speed',speed);
       return speed;
   };

   function calDistance(user,cycleCount){
       if(cycleCount == 0){
           console.log('자전거 바퀴가 한번도 회전하지 않았어');
       }else{
           distance = cycleCount * Math.PI *((user.bike.diameter/1000)/1000);
           return distance;
       }
   };

   function calIndice(speed){
       if(speed <= 12.9){
           this.indice = 0.065;
       }else if(speed > 12.9 && speed <= 16.1){
           this.indice = 0.0783;
       }else if(speed > 16.1 && speed <= 19.3){
           this.indice = 0.0939;
       }else if(speed > 19.3 && speed <= 22.5){
           this.indice = 0.1129;
       }else if(speed > 22.5 && speed <= 24.1){
           this.indice = 0.01237;
       }else if(speed > 24.1 && speed <= 25.7){
           this.indice = 0.1356;
       }else if(speed > 27.4 && speed <= 29){
           this.indice = 0.1488;
       }else if(speed > 29 && speed <= 30.6){
           this.indice = 0.1631;
       }else if(speed > 30.6 && speed <= 32.2){
           this.indice = 0.1788;
       }else if(speed > 32.2 && speed <= 33.8){
           this.indice = 0.1964;
       }else if(speed > 33.8 && speed <= 37){
           this.indice = 0.215;
       }else if(speed > 37 && speed <= 40.2){
           this.indice = 0.2586;
       }else{
           this.indice = 0.3111;
       }
   };

   function Bike(diameter,bike_weight){
       this.bike_weight = weight;
       this.diameter = diameter;
   }

   function startPlay(){
       //cycleCount를 초기화 한다.
       firebase.database().ref('/user/cycleCount').set(0);
       
       //startTime의 log값을 만든다.
       var startAt = new Date();
       strStartAt = dateToString(startAt);
       var ref ='/user/log/'+strStartAt;
       firebase.database().ref(ref+'/distance').set(0);
       firebase.database().ref(ref+'/kcal').set(0);
       firebase.database().ref(ref+'/endTime').set(0);
       firebase.database().ref(ref+'/avgSpeed').set(0);
       firebase.database().ref('/user').once('value').then(function(snapshot) {
           data = snapshot.val();    
           var newUser = new User();
           newUser.weight= data['weight'];
           newUser.bike = data['bike'];  
           var newLog = new Log();
           newLog.user=newUser;
           newLog.startAt=startAt;
           playing(newLog,newUser);
       });
   }
   
   function dateToString(date)
   {
       this.yyyy = date.getFullYear().toString();
       this.MM = (date.getMonth() + 1).toString();
       this.dd = date.getDate().toString();
       this.hh = date.getHours().toString();
       this.mm = date.getMinutes().toString();
       this.ss = date.getSeconds().toString();
       return yyyy + (MM[1] ? MM : '0'+ MM[0]) + (dd[1] ? dd : '0'+dd[0])+(hh[1] ? hh : '0'+hh[0])+(mm[1] ? mm : '0'+mm[0])+(ss[1] ? ss : '0'+ss[0]);
   }

   function endPlay(){
       
   }

   /* 운동 시작버튼 클릭 시 */
     $('#startPlay').click(function(){
       var startAt = new Date();
       var btn_startPlay = document.getElementById('startPlay');
       var btn_pause = document.getElementById('pause');
       var btn_endPlay = document.getElementById('endPlay');
       printClock(startAt);

       /*일시정지 운동 끝 버튼 활성화, 운동 시작 버튼 비 활성화*/
       btn_startPlay.classList.add('disabled');
       btn_pause.classList.remove('disabled');
       btn_endPlay.classList.remove('disabled');
   });

    var pauseFlag = 0  // 0 => 일시정지한 상태 , 1=> 다시 시작한 상태
    /* 일시정지버튼  클릭 시 */
    $('#pause').click(function(){
        var btn_startPlay = document.getElementById('startPlay');
        var btn_pause = document.getElementById('pause');
        var btn_endPlay = document.getElementById('endPlay');
        
        btn_startPlay.classList.add('disabled');
        btn_pause.classList.remove('disabled');
        btn_endPlay.classList.remove('disabled');
        
        if(pauseFlag == 0){
            $('#pause').text('이어서하기');
            pauseFlag = 1;
            setTimeout(function(){
                clearInterval(startInterval);
            }, 0);
        }else if(pauseFlag == 1){
            $('#pause').text('일시정지');
            pauseFlag =0;
            startInterval = printClock(playTime);
        }
        //firebase애 있는 운동시간을 업데이트한다.
        var ref ='/user/log/'+strStartAt;
            firebase.database().ref(ref+'/exerciseTime').set(playTime);
    });
   
   /* 운동 종료버튼  클릭 시 */
   $('#endPlay').click(function(){
        var btn_startPlay = document.getElementById('startPlay');
        var btn_pause = document.getElementById('pause');
        var btn_endPlay = document.getElementById('endPlay');
        
        btn_startPlay.classList.remove('disabled');
        btn_pause.classList.add('disabled');
        btn_endPlay.classList.add('disabled');
        //firebase애 있는 운동시간을 업데이트한다.
        var ref ='/user/log/'+strStartAt;
        firebase.database().ref(ref+'/exerciseTime').set(playTime);
    });

       function addZeros(num, digit) { // 자릿수 맞춰주기
           var zero = '';
           num = num.toString();
           if (num.length < digit) {
               for (i = 0; i < digit - num.length; i++) {
               zero += '0';
               }
           }
           return zero + num;
       }
   
   /* 로그아웃 버튼을 눌렀을 때 인증 해제 하도록 하기 */
   $('#BTN_LOGOUT').click(function(){
     firebase.auth().signOut().then(function() {
       alert("인증이 해제되었습니다.");
       location.href = "./";
     }, function(error) {
       alert(error.message);
     });
   });
    </script>
  </body>
</html>
