<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

    <title>CYCLE DASH</title>

    <!-- Bootstrap core CSS -->
	<link href="assets/css/bootstrap.css" rel="stylesheet">
	<link href="assets/css/font-awesome.css" rel="stylesheet">
	<link href="assets/css/docs.css" rel="stylesheet" >
	<link href="bootstrap-social.css" rel="stylesheet" >
	<!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"> -->
	<!--external css-->
	<!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous"> -->
        
    <!-- Custom styles for this template -->
    <link href="assets/css/style.css" rel="stylesheet">
	<link href="assets/css/style-responsive.css" rel="stylesheet">
	
	 <!-- firebase SDK 링크 -->
	 <script src="https://www.gstatic.com/firebasejs/5.4.1/firebase.js"></script>
	 <script src="https://www.gstatic.com/firebasejs/5.4.1/firebase-app.js"></script>
	 <script src="https://www.gstatic.com/firebasejs/5.4.1/firebase-auth.js"></script>
	 <script src="https://www.gstatic.com/firebasejs/5.4.1/firebase-database.js"></script>
	 
	 <script src="index.js"></script>
	 <script src="fireinit.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

      <!-- **********************************************************************************************************************************************************
      Login CONTENT
      *********************************************************************************************************************************************************** -->

	  <div id="my-page">
	  	<div class="container">
	  	
		      <form class="form-login" action="index.html">
		        <h2 class="form-login-heading">마이 페이지</h2>
		        <div class="login-wrap">
					<!-- 몸무게 입력 폼 -->
		            <input id="INPUT_WEIGHT" type="number" class="form-control" placeholder="몸무게를 입력하세요" autofocus>
					<br>
					<!-- 자전거 무게 입력 폼 -->
					<input id="INPUT_BIKE" type="number" class="form-control" placeholder="자전거 무게를 입력하세요">
					<br>
					<!-- 휠 사이즈 입력 폼 -->
					<div class="input-group">
						<input id="INPUT_WHEEL" style="height: 33.9px" type="number" class="form-control" placeholder="휠 사이즈를 입력하세요">
						<div class="input-group-btn">
							<button id="BTN_DROPDOWN" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">휠 단위 <span class="caret"></span></button>
							<ul class="dropdown-menu dropdown-menu-right" role="menu">
							<li value='10'><a value=10>(cm)</a></li>
							<li value='1'><a >(mm)</a></li>
							<li value='25.4'><a>(in)</a></li>
							</ul>
						</div><!-- /btn-group -->
					</div><!-- /input-group -->
					<br>
					<!-- 목표칼로리 입력 폼 -->
					<input id="INPUT_CALORIES" type="number" class="form-control" placeholder="목표 칼로리를 입력하세요">
					<br>
					<!-- 저장 버튼  -->
					<button id="BTN_SAVE" class="btn btn-theme btn-block" type="button"><i class="fa fa-save"></i> 저 장 하 기</button>
					<br>
					<!-- 메인화면 버튼  -->
		            <button id="BTN_MAIN" class="btn btn-success btn-block" type="button"><i class="fa fa-home"></i> 메 인 화 면</button>
					
		      </form>	  	
	  	
	  	</div>
	  </div>
	
    <!-- js placed at the end of the document so the pages load faster -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>

    <!--BACKSTRETCH-->
    <!-- You can use an image of whatever size. This script will stretch to fit in any screen size.-->
    <script type="text/javascript" src="assets/js/jquery.backstretch.min.js"></script>
    <script>
        $.backstretch("assets/img/login-bg.jpg", {speed: 500});
	</script>
 <script type="text/javascript">

   /* 인증 상태 변화 감시하기 */
   firebase.auth().onAuthStateChanged(function(user) {
	 if (user) { // 인증되었을 때
	//    location.href="./dash.html";
	 } else { // 인증되지 않았을 때
	   $('#AUTH_STATE').text("(인증되지 않음)");
	   $('#BTN_LOGOUT').hide();
	   $('#USER_INFO').hide();
	 }
   });
	
	/* 드롭다운 리스트 클릭시 */
	$(function(){
		$(".dropdown-menu li").click(function(){
		$(".btn:first-child").text($(this).text());
		$(".btn:first-child").val($(this).text());
		// $(".btn:first-child").text($(this).attr('value'));
		});
	});


    /* 마이 페이지 Enter Key를 눌렀을 경우  */
	var input = document.getElementById("INPUT_CALORIES");
	input.addEventListener("keyup", function(event) {
		event.preventDefault();
		if (event.keyCode === 13){
			document.getElementById("BTN_SAVE").click();
		}
	});

	/* 저장 버튼 클릭시 처리 */
	$('#BTN_SAVE').click(function(){
	  var new_weight = $("#INPUT_WEIGHT").val();
	  var new_bike = $("#INPUT_BIKE").val();
	  var new_calories = $("#INPUT_CALORIES").val();
	  var new_dimeter = $(".dropdown-menu li").val();
	  var new_wheel = $("#INPUT_WHEEL").val();
	  var result = parseFloat(new_wheel)*parseFloat(new_dimeter);

	  var updates = {};
	  updates['/user/weight'] = parseInt(new_weight);
	  updates['/user/bike/bike_weight'] = parseInt(new_bike);
	  updates['/user/bike/diameter'] = parseFloat(result);
	  updates['/user/targetKcal'] = parseInt(new_calories);

	  firebase.database().ref().update(updates);
	  alert('성공했습니다.');
	  if(updates){
		location.href="./dash.html"; 
	  }
	//   location.href="./dash.html";
	});

	/* 메인화면 버튼 클릭시 처리 */
	$('#BTN_MAIN').click(function(){
		location.href="./dash.html";
	});
	
	/* FireBase 값 읽어오기 Test*/
	firebase.database().ref('/user/bike/diameter').on('value', function(snapshot) {
      var message = snapshot.val();
      $("#DB_MESSAGE").text(message);
	});
	
	</script>
  </body>
</html>
